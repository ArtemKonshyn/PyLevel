---


---

<h1 id="тестирование-в-django">Тестирование в Django</h1>
<p><img src="https://files.realpython.com/media/Django-Tutorials_Watermarked.2ecff49f3456.jpg" alt="enter image description here"></p>
<h2 id="план">План</h2>
<ol>
<li>Тестирование в Django
<ol>
<li>Особенности тестирования</li>
<li>Фабрики</li>
<li>Factory Boy, Fuzzy</li>
</ol>
</li>
<li>Tестирование DRF, API</li>
</ol>
<h2 id="тестирование-в-django-1">Тестирование в Django</h2>
<p>Если вы пишете тесты для веб-приложений, то стоит помнить о важных отличиях в написании и запуске таких тестов.</p>
<p>Подумайте о коде, который нужно протестировать в веб-приложении. Все маршруты, представления и модели требуют много импортов и знаний об используемом фреймворке.<br>
Это похоже на тестирование автомобиля: перед тем, как провести простые тесты, вроде проверки работы фар, нужно включить компьютер в машине.</p>
<p>Django упрощают эту задачу и предоставляют тестовый фреймворк на базе unittest. Вы можете продолжать писать тесты привычным образом, но исполнять их чуть иначе.</p>
<p>Шаблон Django startapp создает файл <a href="http://test.py">test.py</a> в каталоге вашего приложения. Если его еще нет, создайте его со следующим содержимым:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">class</span> <span class="token class-name">MyTestCase</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Your test methods</span>
</code></pre>
<p>Основное отличие от прошлых примеров — нужно наследовать из <code>django.test.TestCase</code>, а не <code>unittest.TestCase</code>.</p>
<pre class=" language-python"><code class="prism  language-python">TestCase<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.TestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.TransactionTestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.SimpleTestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'unittest.case.TestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre>
<p>Для исполнения тестового набора используйте <code>manage.py</code> test вместо unittest в командной строке:</p>
<pre class=" language-python"><code class="prism  language-python">$ <span class="token punctuation">.</span><span class="token operator">/</span>manage<span class="token punctuation">.</span>py test
</code></pre>
<p>Если вам нужно несколько тестовых файлов, замените <a href="http://tests.py">tests.py</a> на папку tests, положите в нее пустой файл с названием <code>__init__.py</code> и создайте файлы <code>test_*.py</code>. Django обнаружит их и выполнит.</p>
<p><strong>База данных для тестирования</strong></p>
<p>Для тестов используется отдельная база данных, которая будет указана в переменной  <code>TEST</code>  в переменной  <code>DATABASES</code>  в файле  <code>settings.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.postgresql'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'mydatabaseuser'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mydatabase'</span><span class="token punctuation">,</span>
        <span class="token string">'TEST'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mytestdatabase'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Эта база будет изначально пустая, и будет очищаться после каждого выполненного тест кейса. Что-бы не очишать базу, можно указать параметр <code>--keepdb</code> (или <code>-k</code>)</p>
<h3 id="настрока-в-pycharm">Настрока в PyCharm</h3>
<p><img src="https://i.imgur.com/nXuZnEY.png" alt="enter image description here"></p>
<p>Тестирование сайта это сложная задача, потому что она состоит их нескольких логических слоев – от HTTP-запроса и запроса к моделям, до валидации формы и их обработки, а кроме того, рендеринга шаблонов страниц.</p>
<p>Django предоставляет фреймворк для создания тестов, построенного на основе иерархии классов, которые, в свою очередь, зависят от стандартной библиотеки Python <code>[unittest]</code>. Несмотря на название, данный фреймворк подходит и для юнит-, и для интеграционного тестирования. Фреймворк Django добавляет методы API и инструменты, которые помогают тестировать как веб так и, специфическое для Django, поведение. Это позволяет вам имитировать URL-запросы, добавление тестовых данных, а также проводить проверку выходных данных ваших приложений.</p>
<h2 id="литература">Литература</h2>
<ol>
<li><a href="https://developer.mozilla.org/ru/docs/Learn/Server-side/Django/Testing">Тестирование приложений Django</a></li>
</ol>

