---


---

<h1 id="тестирование-в-django">Тестирование в Django</h1>
<p><img src="https://files.realpython.com/media/Django-Tutorials_Watermarked.2ecff49f3456.jpg" alt="enter image description here"></p>
<h2 id="план">План</h2>
<ol>
<li>Тестирование в Django
<ol>
<li>Особенности тестирования</li>
<li>Client</li>
</ol>
</li>
<li>Tестирование DRF, API</li>
<li>Фабрики
<ol>
<li>Factory Boy, Fuzzy</li>
</ol>
</li>
</ol>
<h2 id="тестирование-в-django-1">Тестирование в Django</h2>
<p>Если вы пишете тесты для веб-приложений, то стоит помнить о важных отличиях в написании и запуске таких тестов.</p>
<p>Подумайте о коде, который нужно протестировать в веб-приложении. Все маршруты, представления и модели требуют много импортов и знаний об используемом фреймворке.<br>
Это похоже на тестирование автомобиля: перед тем, как провести простые тесты, вроде проверки работы фар, нужно включить компьютер в машине.</p>
<p>Django упрощают эту задачу и предоставляют тестовый фреймворк на базе unittest. Вы можете продолжать писать тесты привычным образом, но исполнять их чуть иначе.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">class</span> <span class="token class-name">MyTestCase</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span>
<span class="token punctuation">:</span>   
    <span class="token keyword">def</span> <span class="token function">setUp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Установки запускаются перед каждым тестом</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">tearDown</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Очистка после каждого метода</span>
        <span class="token keyword">pass</span>

    <span class="token keyword">def</span> <span class="token function">test_something_that_will_pass</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertFalse<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_something_that_will_fail</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre>
<p>Основное отличие от прошлых примеров — нужно наследовать из <code>django.test.TestCase</code>, а не <code>unittest.TestCase</code>.</p>
<pre class=" language-python"><code class="prism  language-python">TestCase<span class="token punctuation">.</span>mro<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.TestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.TransactionTestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'django.test.testcases.SimpleTestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'unittest.case.TestCase'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'object'</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre>
<p><img src="https://docs.djangoproject.com/en/2.2/_images/django_unittest_classes_hierarchy.svg" alt="enter image description here"><br>
Для исполнения тестового набора используйте <code>manage.py</code> test вместо unittest в командной строке:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token punctuation">.</span><span class="token operator">/</span>manage<span class="token punctuation">.</span>py test
</code></pre>
<p>Если вам нужно несколько тестовых файлов, замените <a href="http://tests.py">tests.py</a> на папку tests, положите в нее пустой файл с названием <code>__init__.py</code> и создайте файлы <code>test_*.py</code>. Django обнаружит их и выполнит.</p>
<p><strong>База данных для тестирования</strong></p>
<p>Для тестов используется отдельная база данных, которая будет указана в переменной  <code>TEST</code>  в переменной  <code>DATABASES</code>  в файле  <code>settings.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python">DATABASES <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'default'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'ENGINE'</span><span class="token punctuation">:</span> <span class="token string">'django.db.backends.postgresql'</span><span class="token punctuation">,</span>
        <span class="token string">'USER'</span><span class="token punctuation">:</span> <span class="token string">'mydatabaseuser'</span><span class="token punctuation">,</span>
        <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mydatabase'</span><span class="token punctuation">,</span>
        <span class="token string">'TEST'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'NAME'</span><span class="token punctuation">:</span> <span class="token string">'mytestdatabase'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Эта база будет изначально пустая, и будет очищаться после каждого выполненного тест кейса. Что-бы не очишать базу, можно указать параметр <code>--keepdb</code> (или <code>-k</code>)</p>
<h3 id="настрока-в-pycharm">Настрока в PyCharm</h3>
<p><img src="https://i.imgur.com/nXuZnEY.png" alt="enter image description here"></p>
<p>Тестирование сайта это сложная задача, потому что она состоит их нескольких логических слоев – от HTTP-запроса и запроса к моделям, до валидации формы и их обработки, а кроме того, рендеринга шаблонов страниц.</p>
<p>Django предоставляет фреймворк для создания тестов, построенного на основе иерархии классов, которые, в свою очередь, зависят от стандартной библиотеки Python <code>unittest</code>. Несмотря на название, данный фреймворк подходит и для юнит-, и для интеграционного тестирования. Фреймворк Django добавляет методы и инструменты, которые помогают тестировать как веб так и, специфическое для Django, поведение. Это позволяет вам имитировать URL-запросы, добавление тестовых данных, а также проводить проверку выходных данных ваших приложений.</p>
<p>django.test.TestCase  класс создает чистую базу данных перед запуском своих методов, а также запускает каждую функцию тестирования в его собственной транзакции. У данного класса также имеется тестовый Клиент, который вы можете использовать для имитации взаимодействия пользователя с кодом на уровне отображения.</p>
<h3 id="новые-assertions">Новые Assertions</h3>
<p><code>assertContains</code>(<em>response</em>, <em>text</em>)<br>
<code>assertNotContains</code>(<em>response</em>, <em>text</em>)<br>
<code>assertTemplateUsed</code>(<em>response</em>, <em>template_name</em>)<br>
<code>assertTemplateNotUsed</code>(<em>response</em>, <em>template_name</em>)<br>
<code>assertURLEqual</code>(<em>url1</em>, <em>url2</em>)<br>
<code>assertRedirects</code>(<em>response</em>, <em>expected_url</em>, <em>status_code=302</em>, <em>target_status_code=200</em>)<br>
<code>assertHTMLEqual</code>(<em>html1</em>, <em>html2</em>)<br>
<code>assertHTMLNotEqual</code>(<em>html1</em>, <em>html2</em>)<br>
<code>assertXMLEqual</code>(<em>xml1</em>, <em>xml2</em>)<br>
<code>assertXMLNotEqual</code>(<em>xml1</em>, <em>xml2</em>)<br>
<code>assertJSONEqual</code>(<em>raw</em>, <em>expected_data</em>)<br>
<code>assertJSONNotEqual</code>(<em>raw</em>, <em>expected_data</em>)</p>
<p>Остальные в <a href="https://docs.djangoproject.com/en/2.2/topics/testing/tools/#assertions">документации</a></p>
<h3 id="client"><a href="https://docs.djangoproject.com/en/2.2/topics/testing/tools/#making-requests">Client</a></h3>
<p>Для проведения интеграционного тестирования джанго приложенния нам необходимо отправлять запросы с клиента (браузера), функционал для этого нам предоставлен из коробки, и мы можем им воспользоваться:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> Client
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> c<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/login/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'john'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'smith'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>status_code
<span class="token number">200</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> c<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/customer/details/'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response<span class="token punctuation">.</span>content
b<span class="token string">'&lt;!DOCTYPE html...'</span>
</code></pre>
<p>Такой запрос не будет требовать CSRF токен</p>
<p>Поддерживает метод  <code>login()</code></p>
<pre class=" language-python"><code class="prism  language-python">c <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>login<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'fred'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">'secret'</span><span class="token punctuation">)</span>
</code></pre>
<p>после чего запросы будут приходть от авторизированого пользователя<br>
и метод  <code>force_login</code>  принимающий объект юзера, а не логин и пароль.<br>
и метод  <code>logout()</code></p>
<p><strong>GET</strong></p>
<pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> response <span class="token operator">=</span> c<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'/customers/details/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'fred'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">7</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>отправит GET запрос на</p>
<pre><code>/customers/details/?name=fred&amp;age=7
</code></pre>
<p><strong>POST</strong></p>
<pre class=" language-python"><code class="prism  language-python"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c <span class="token operator">=</span> Client<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'/login/'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'fred'</span><span class="token punctuation">,</span> <span class="token string">'passwd'</span><span class="token punctuation">:</span> <span class="token string">'secret'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>И response запишет ответ<br>
отправит POST запрос на</p>
<pre><code>/login/
</code></pre>
<h3 id="response">response</h3>
<pre class=" language-python"><code class="prism  language-python">response <span class="token operator">=</span> <span class="token punctuation">{</span>TemplateResponse<span class="token punctuation">}</span> <span class="token operator">&lt;</span>TemplateResponse status_code<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"text/html; charset=utf-8"</span><span class="token operator">&gt;</span>
 charset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">}</span> <span class="token string">'utf-8'</span>
 client <span class="token operator">=</span> <span class="token punctuation">{</span>Client<span class="token punctuation">}</span> <span class="token operator">&lt;</span>django<span class="token punctuation">.</span>test<span class="token punctuation">.</span>client<span class="token punctuation">.</span>Client <span class="token builtin">object</span> at <span class="token number">0x7f1b7b1ed850</span><span class="token operator">&gt;</span>
 closed <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">bool</span><span class="token punctuation">}</span> <span class="token boolean">True</span>
 content <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">bytes</span><span class="token punctuation">:</span> <span class="token number">2495</span><span class="token punctuation">}</span> b'<span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>\n  \n  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Local Library<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span>"https<span class="token punctuation">:</span><span class="token operator">//</span>cdn<span class="token punctuation">.</span>jsdelivr<span class="token punctuation">.</span>net<span class="token operator">/</span>npm<span class="token operator">/</span>bootstrap@<span class="token number">4.5</span><span class="token punctuation">.</span><span class="token number">3</span><span class="token operator">/</span>d
 context <span class="token operator">=</span> <span class="token punctuation">{</span>ContextList<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'True'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'False'</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token string">'None'</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'csrf_token'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>SimpleLazyObject<span class="token punctuation">:</span> <span class="token operator">&lt;</span>function csrf<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token builtin">locals</span><span class="token operator">&gt;</span><span class="token punctuation">.</span>_get_val at <span class="token number">0x7f1b7a78d790</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> <span class="token string">'request'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>WSGIRequest<span class="token punctuation">:</span> GET <span class="token string">'/catalog/authors/'</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>SimpleLazyObject<span class="token punctuation">:</span> <span class="token operator">&lt;</span>django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models<span class="token punctuation">.</span>AnonymousUser 
 context_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">dict</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token string">'paginator'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>django<span class="token punctuation">.</span>core<span class="token punctuation">.</span>paginator<span class="token punctuation">.</span>Paginator <span class="token builtin">object</span> at <span class="token number">0x7f1b7a771dc0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'page_obj'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>Page <span class="token number">1</span> of <span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'is_paginated'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token string">'object_list'</span><span class="token punctuation">:</span> <span class="token operator">&lt;</span>QuerySet <span class="token punctuation">[</span><span class="token operator">&lt;</span>Author<span class="token punctuation">:</span> Surname <span class="token number">0</span><span class="token punctuation">,</span> Christian <span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Author<span class="token punctuation">:</span> Surname <span class="token number">1</span><span class="token punctuation">,</span> Christian <span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Author<span class="token punctuation">:</span> Surname <span class="token number">10</span><span class="token punctuation">,</span> Christian <span class="token number">10</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>Au
 cookies <span class="token operator">=</span> <span class="token punctuation">{</span>SimpleCookie<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span> 
 exc_info <span class="token operator">=</span> <span class="token punctuation">{</span>NoneType<span class="token punctuation">}</span> <span class="token boolean">None</span>
 is_rendered <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">bool</span><span class="token punctuation">}</span> <span class="token boolean">True</span>
 json <span class="token operator">=</span> <span class="token punctuation">{</span>partial<span class="token punctuation">}</span> functools<span class="token punctuation">.</span>partial<span class="token punctuation">(</span><span class="token operator">&lt;</span>bound method ClientMixin<span class="token punctuation">.</span>_parse_json of <span class="token operator">&lt;</span>django<span class="token punctuation">.</span>test<span class="token punctuation">.</span>client<span class="token punctuation">.</span>Client <span class="token builtin">object</span> at <span class="token number">0x7f1b7b1ed850</span><span class="token operator">&gt;&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>TemplateResponse status_code<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"text/html; charset=utf-8"</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
 reason_phrase <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">}</span> <span class="token string">'OK'</span>
 rendered_content <span class="token operator">=</span> <span class="token punctuation">{</span>SafeString<span class="token punctuation">}</span> <span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>\n  \n  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Local Library<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">"viewport"</span> content<span class="token operator">=</span><span class="token string">"width=device-width, initial-scale=1"</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"</span> integrity<span class="token operator">=</span><span class="token string">"sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"</span> crossorigin<span class="token operator">=</span><span class="token string">"anonymous"</span><span class="token operator">&gt;</span>\n\n  \n  <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span> Add additional CSS <span class="token keyword">in</span> static <span class="token builtin">file</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>\n  \n  <span class="token operator">&lt;</span>link rel<span class="token operator">=</span><span class="token string">"stylesheet"</span> href<span class="token operator">=</span><span class="token string">"/static/css/styles.78e88d8d7ee5.css"</span><span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>\n<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>\n\n<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"container-fluid"</span><span class="token operator">&gt;</span>\n\n<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"row"</span><span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"col-sm-2"</span><span class="token operator">&gt;</span>\n  \n  <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sidebar-nav"</span><span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/catalog/"</span><span class="token operator">&gt;</span>Home<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/catalog/books/"</span><span class="token operator">&gt;</span>All books<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>\n    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/catalog/authors/"</span><span class="token operator">&gt;</span>All authors<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>\n \n  <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"sidebar-nav"</span><span class="token operator">&gt;</span>\n   \n     <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/accounts/login/?next=/catalog/authors/"</span><span class="token operator">&gt;</span>Login<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>   \n    \n  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>\n  \n   \n \n\n  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>\n  <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"col-sm-10 "</span><span class="token operator">&gt;</span>\n  \n\n<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>Author List<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>\n\n\n  <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>\n\n  \n    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span>\n<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 rendering_attrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token string">'template_name'</span><span class="token punctuation">,</span> <span class="token string">'context_data'</span><span class="token punctuation">,</span> <span class="token string">'_post_render_callbacks'</span><span class="token punctuation">,</span> <span class="token string">'_request'</span><span class="token punctuation">]</span>
 request <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">dict</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token string">'PATH_INFO'</span><span class="token punctuation">:</span> <span class="token string">'/catalog/authors/'</span><span class="token punctuation">,</span> <span class="token string">'REQUEST_METHOD'</span><span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'SERVER_PORT'</span><span class="token punctuation">:</span> <span class="token string">'80'</span><span class="token punctuation">,</span> <span class="token string">'wsgi.url_scheme'</span><span class="token punctuation">:</span> <span class="token string">'http'</span><span class="token punctuation">,</span> <span class="token string">'QUERY_STRING'</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span>
 resolver_match <span class="token operator">=</span> <span class="token punctuation">{</span>ResolverMatch<span class="token punctuation">}</span> ResolverMatch<span class="token punctuation">(</span>func<span class="token operator">=</span>catalog<span class="token punctuation">.</span>views<span class="token punctuation">.</span>AuthorListView<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> kwargs<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> url_name<span class="token operator">=</span>authors<span class="token punctuation">,</span> app_names<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> namespaces<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> route<span class="token operator">=</span>catalog<span class="token operator">/</span>authors<span class="token operator">/</span><span class="token punctuation">)</span>
 status_code <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">int</span><span class="token punctuation">}</span> <span class="token number">200</span>
 streaming <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">bool</span><span class="token punctuation">}</span> <span class="token boolean">False</span>
 template_name <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token string">'catalog/author_list.html'</span><span class="token punctuation">]</span>
 templates <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token builtin">list</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>django<span class="token punctuation">.</span>template<span class="token punctuation">.</span>base<span class="token punctuation">.</span>Template <span class="token builtin">object</span> at <span class="token number">0x7f1b7a6dbcd0</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span>django<span class="token punctuation">.</span>template<span class="token punctuation">.</span>base<span class="token punctuation">.</span>Template <span class="token builtin">object</span> at <span class="token number">0x7f1b7a7a6ee0</span><span class="token operator">&gt;</span><span class="token punctuation">]</span>
 using <span class="token operator">=</span> <span class="token punctuation">{</span>NoneType<span class="token punctuation">}</span> <span class="token boolean">None</span>
 wsgi_request <span class="token operator">=</span> <span class="token punctuation">{</span>WSGIRequest<span class="token punctuation">}</span> <span class="token operator">&lt;</span>WSGIRequest<span class="token punctuation">:</span> GET <span class="token string">'/catalog/authors/'</span><span class="token operator">&gt;</span>
</code></pre>
<p><strong>Структура тестов</strong><br>
<img src="https://drive.google.com/uc?export=view&amp;id=1E_Tf8H2spWJbSOaaxvWOMiLk4c0bgvUT" alt="enter image description here"></p>
<h3 id="тестирование-view">Тестирование view</h3>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">AuthorListView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Author
    paginate_by <span class="token operator">=</span> <span class="token number">10</span>
</code></pre>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token comment"># Create your tests here.</span>

<span class="token keyword">from</span> catalog<span class="token punctuation">.</span>models <span class="token keyword">import</span> Author
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">class</span> <span class="token class-name">AuthorListViewTest</span><span class="token punctuation">(</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    @<span class="token builtin">classmethod</span>
    <span class="token keyword">def</span> <span class="token function">setUpTestData</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#Create 13 authors for pagination tests</span>
        number_of_authors <span class="token operator">=</span> <span class="token number">13</span>
        <span class="token keyword">for</span> author_num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>number_of_authors<span class="token punctuation">)</span><span class="token punctuation">:</span>
            Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>first_name<span class="token operator">=</span><span class="token string">'Christian %s'</span> <span class="token operator">%</span> author_num<span class="token punctuation">,</span> last_name <span class="token operator">=</span> <span class="token string">'Surname %s'</span> <span class="token operator">%</span> author_num<span class="token punctuation">,</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_index</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'authors'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
		assertContains`<span class="token punctuation">(</span>response<span class="token punctuation">,</span> <span class="token string">'Christian'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTemplateUsed<span class="token punctuation">(</span>resp<span class="token punctuation">,</span> <span class="token string">'catalog/author_list.html'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_pagination_is_ten</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'authors'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'is_paginated'</span> <span class="token keyword">in</span> resp<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'is_paginated'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span> <span class="token builtin">len</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'author_list'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">test_lists_all_authors</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#Get second page and confirm it has (exactly) remaining 3 items</span>
        resp <span class="token operator">=</span> self<span class="token punctuation">.</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'authors'</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'?page=2'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>status_code<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token string">'is_paginated'</span> <span class="token keyword">in</span> resp<span class="token punctuation">.</span>context<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span>resp<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'is_paginated'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span> <span class="token builtin">len</span><span class="token punctuation">(</span>resp<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">'author_list'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre>
<h2 id="литература">Литература</h2>
<ol>
<li><a href="https://developer.mozilla.org/ru/docs/Learn/Server-side/Django/Testing">Тестирование приложений Django</a></li>
</ol>

